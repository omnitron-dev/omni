# Task Manager Module - Анализ архитектурных проблем

## Текущие проблемы

### 1. Типизация
- **Проблема**: Использование `any` в `onStart(app: any)` вместо правильного типа `IApplication`
- **Влияние**: Потеря type-safety, возможные ошибки runtime

### 2. Жизненный цикл регистрации провайдеров
- **Проблема**: Провайдеры регистрируются в `onStart()` - это слишком поздно
- **Правильный порядок**:
  1. `onRegister()` - регистрация провайдеров и зависимостей
  2. `onStart()` - инициализация уже зарегистрированных сервисов
  3. `onStop()` - остановка сервисов
- **Текущий порядок нарушен**: провайдеры регистрируются и инициализируются в одном методе

### 3. Отсутствие декларативной связи с модулем
- **Проблема**: `app.register(TaskServiceToken, { useClass: TaskService })` регистрирует глобально
- **Недостатки**:
  - Нет явной связи сервиса с модулем-владельцем
  - Сложно отследить, какой модуль отвечает за какие сервисы
  - Невозможно изолировать провайдеры модуля

### 4. Ручное управление жизненным циклом
- **Проблема**: Ручные вызовы `onInit()` и `onDestroy()` для каждого сервиса
- **Недостатки**:
  - Легко забыть вызвать метод
  - Дублирование кода
  - Нет автоматической обработки ошибок

### 5. Отсутствие декларативной конфигурации модуля
- **Проблема**: Нет декоратора для указания провайдеров модуля
- **Желаемое решение**:
```typescript
@Module({
  providers: [TaskService, NotificationService, TaskCoordinator],
  imports: [LoggerModule, ConfigModule],
  exports: [TaskServiceToken]
})
class TaskManagerModule { }
```

## Предлагаемые улучшения

### 1. Новый декоратор @Module
- Декларативное указание провайдеров
- Автоматическая регистрация в правильной фазе жизненного цикла
- Поддержка импортов и экспортов

### 2. Улучшенный базовый класс AbstractModule
- Автоматическое управление провайдерами
- Правильная типизация методов
- Встроенная поддержка жизненного цикла сервисов

### 3. Автоматическое управление жизненным циклом
- Автоматический вызов `onInit()` для всех провайдеров
- Автоматический вызов `onDestroy()` при остановке
- Правильный порядок инициализации/остановки

### 4. Улучшенная изоляция и связывание
- Провайдеры привязаны к модулю
- Возможность экспорта только определенных токенов
- Лучшая инкапсуляция