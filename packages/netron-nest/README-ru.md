# Netron NestJS Integration

**@omnitron-dev/netron-nest** –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ª—ë–≥–∫—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞ **Netron** —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ **NestJS**, –ø–æ–∑–≤–æ–ª—è—è –ª–µ–≥–∫–æ —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã–µ, –Ω–∞–¥—ë–∂–Ω—ã–µ –∏ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤—ã–µ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã.

## üìñ –û –ø—Ä–æ–µ–∫—Ç–µ

Netron NestJS ‚Äî —ç—Ç–æ –º–æ—â–Ω–∞—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞–º NestJS (—Ç–∞–∫–∏–º –∫–∞–∫ gRPC, Kafka, Redis –∏ RabbitMQ), –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—â–∞—è –ø—Ä–æ—Å—Ç–æ–π –∏ –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤ —Å –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–º –º–µ—Ö–∞–Ω–∏–∑–º–æ–º —Å–µ—Ä–≤–∏—Å-–¥–∏—Å–∫–∞–≤–µ—Ä–∏, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º heartbeat –∏ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å—é –Ω–∞ –æ—Å–Ω–æ–≤–µ Redis.

---

## üöÄ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- üö¶ **–°–µ—Ä–≤–∏—Å-–¥–∏—Å–∫–∞–≤–µ—Ä–∏** –Ω–∞ –æ—Å–Ω–æ–≤–µ Redis —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º heartbeat
- üì° **RPC –∏ Event Streams** –¥–ª—è –º–µ–∂—Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
- üîß **–î–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏ —ç–∫—Å–ø–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤**
- üîÑ **–ü—Ä–æ–∑—Ä–∞—á–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** —Å DI-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º NestJS
- üí° **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ —ç–∫—Å–ø–æ–∑–∏—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤**
- üîÑ **Graceful shutdown** –∏ –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- üß™ **–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏**

---

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
npm install @omnitron-dev/netron @omnitron-dev/netron-nest
```

---

## üéØ –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞ —Å Netron

```typescript
import { Module } from '@nestjs/common';
import { NetronModule } from '@omnitron-dev/netron-nest';
import { AuthService } from './auth.service';

@Module({
  imports: [
    NetronModule.forRoot({
      listenHost: 'localhost',
      listenPort: 4000,
      discoveryEnabled: true,
      discoveryRedisUrl: 'redis://localhost:6379/0',
    }),
  ],
  providers: [AuthService],
})
export class AppModule {}
```

### –≠–∫—Å–ø–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤ —Å –ø–æ–º–æ—â—å—é –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞

```typescript
import { Injectable } from '@nestjs/common';
import { Service } from '@omnitron-dev/netron-nest';

@Injectable()
@Service('auth@1.0.0')
export class AuthService {
  login(user: string, pass: string) {
    return user === 'admin' && pass === 'admin';
  }
}
```

### –í—ã–∑–æ–≤ —É–¥–∞–ª—ë–Ω–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞

```typescript
import { Injectable } from '@nestjs/common';
import { InjectNetron, Netron } from '@omnitron-dev/netron-nest';

@Injectable()
export class RemoteService {
  constructor(@InjectNetron() private readonly netron: Netron) {}

  async authenticate(user: string, pass: string): Promise<boolean> {
    const authService = await this.netron.getService('auth@1.0.0');
    return authService.login(user, pass);
  }
}
```

---

## üîç –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º–∏ NestJS (gRPC)

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞                      | NestJS (gRPC)                       | Netron NestJS                      |
| ----------------------------------- | ----------------------------------- | ---------------------------------- |
| –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç                           | HTTP/2                              | WebSocket                          |
| –°–µ—Ä–≤–∏—Å-–¥–∏—Å–∫–∞–≤–µ—Ä–∏                    | –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç (–Ω–µ–æ–±—Ö–æ–¥–∏–º–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞)  | –í—Å—Ç—Ä–æ–µ–Ω–Ω–æ–µ (Redis-based)           |
| –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤ | –ù–µ—Ç                                 | –î–∞                                 |
| –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö —É–∑–ª–æ–≤       | –¢–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–∏ –Ω–∞–≥—Ä—É–∑–∫–∏| –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (heartbeat, TTL)     |
| Graceful Shutdown                   | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞              | –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞                   |
| –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å                  | –í—ã—Å–æ–∫–∞—è                             | –í—ã—Å–æ–∫–∞—è                            |
| –ü–æ—Ç–æ–∫–∏ –∏ —Å–æ–±—ã—Ç–∏–π–Ω–æ—Å—Ç—å               | Stream (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π HTTP/2)        | –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–µ –ø–æ—Ç–æ–∫–∏ —á–µ—Ä–µ–∑ WebSocket |
| –ü—Ä–æ—Å—Ç–æ—Ç–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏                  | –°—Ä–µ–¥–Ω—è—è (—Ç—Ä–µ–±—É–µ—Ç proto-—Ñ–∞–π–ª–æ–≤)      | –í—ã—Å–æ–∫–∞—è (–¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–µ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã) |

### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Netron –≤–º–µ—Å—Ç–æ gRPC?

- üìå **–ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤** –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ middleware.
- üìå **–ï—Å–ª–∏ –≤–∞–∂–Ω–∞ –ø—Ä–æ—Å—Ç–æ—Ç–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏** –±–µ–∑ –ø—Ä–æ—Ç–æ–∫–æ–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ (`.proto`) –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤.
- üìå **–ï—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞–¥—ë–∂–Ω–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** –∏ –º–µ—Ö–∞–Ω–∏–∑–º heartbeat –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —É–∑–ª–æ–≤.
- üìå **–ï—Å–ª–∏ –≤–∞–∂–Ω—ã –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–µ —Å—Ç—Ä–∏–º—ã –∏ —Å–æ–±—ã—Ç–∏–π–Ω–∞—è –º–æ–¥–µ–ª—å** –ø–æ–≤–µ—Ä—Ö WebSocket.

---

## üõ†Ô∏è –†–∞–±–æ—Ç–∞ —Å Redis (—Å–µ—Ä–≤–∏—Å-–¥–∏—Å–∫–∞–≤–µ—Ä–∏)

Netron –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Redis –≤ –∫–∞—á–µ—Å—Ç–≤–µ backend –¥–ª—è —Å–µ—Ä–≤–∏—Å-–¥–∏—Å–∫–∞–≤–µ—Ä–∏. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–µ—Ä–≤–∏—Å–∞–º:

- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–µ–±—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ.
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å heartbeat (TTL-–∫–ª—é—á–∏) –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏.
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Redis Pub/Sub –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ —Å–µ—Ä–≤–∏—Å–æ–≤.

---

## ‚úÖ –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏

–¢–µ—Å—Ç—ã –≤–∫–ª—é—á–∞—é—Ç:

- Unit –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –¢–µ—Å—Ç—ã –Ω–∞ –æ—à–∏–±–∫–∏ –∏ retry-–ª–æ–≥–∏–∫—É Redis
- Lifecycle-—Ç–µ—Å—Ç—ã (–∑–∞–ø—É—Å–∫, graceful shutdown)

–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ —Å Jest:

```bash
npm run test
```

---

## üìå –í–∞–∂–Ω—ã–µ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã –∏ —Ç–æ–∫–µ–Ω—ã

- `@Service(name@version)` ‚Äì —ç–∫—Å–ø–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤
- `@InjectNetron()` ‚Äì –∏–Ω–∂–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Å—Ç–∞–Ω—Å–∞ Netron
- `NETRON_OPTIONS`, `NETRON_INSTANCE` ‚Äì —Ç–æ–∫–µ–Ω—ã –¥–ª—è DI

---

## üìö –ü–æ–¥—Ä–æ–±–Ω—ã–π –ø—Ä–∏–º–µ—Ä –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞ (NestJS + Netron)

### –°–µ—Ä–≤–µ—Ä (–º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å):

```typescript
import { Module } from '@nestjs/common';
import { NetronModule } from '@omnitron-dev/netron-nest';

@Module({
  imports: [
    NetronModule.forRoot({
      listenHost: 'localhost',
      listenPort: 5000,
      discoveryEnabled: true,
      discoveryRedisUrl: 'redis://localhost:6379/1',
    }),
  ],
})
export class UserServiceModule {}
```

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–∞:

```typescript
import { Injectable } from '@nestjs/common';
import { Service } from '@omnitron-dev/netron-nest';

@Injectable()
@Service('user.service@1.0.0')
export class UserService {
  getUser(id: string) {
    return { id, name: 'John Doe' };
  }
}
```

### –ö–ª–∏–µ–Ω—Ç (–¥—Ä—É–≥–æ–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å):

```typescript
import { Injectable } from '@nestjs/common';
import { InjectNetron, Netron } from '@omnitron-dev/netron-nest';

@Injectable()
export class ClientService {
  constructor(@InjectNetron() private readonly netron: Netron) {}

  async fetchUser(id: string) {
    const userService = await this.netron.getService('user.service@1.0.0');
    return userService.getUser(id);
  }
}
```

---

## ‚öñÔ∏è –õ–∏—Ü–µ–Ω–∑–∏—è

MIT ¬© LuxQuant